
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Archiviazione Automatica Dinamica</title>
  <script>
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name) || "";
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const fileName = getQueryParam("fileName");
      const fileContent = getQueryParam("content").replaceAll("<<n>>", "\n");
      const nomeChat = getQueryParam("nomeChat") || "Chat senza nome";
      const modulo = getQueryParam("modulo") || nomeChat;
      const note = getQueryParam("note") || "Archiviazione automatica";

      if (!fileName || !fileContent) {
        console.error("❌ Dati mancanti. fileName e content sono obbligatori.");
        return;
      }

      const payload = {
        fileName,
        fileContent,
        nomeChat,
        modulo,
        note
      };

      try {
        const response = await fetch("/api/archivia", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const text = await response.text();
        console.log("✅ Risposta da /api/archivia:", text);
      } catch (err) {
        console.error("❌ Errore durante il POST:", err);
      }
    });
  </script>
</head>
<body style="display:none;">
  <!-- Invisibile -->
</body>
</html>
