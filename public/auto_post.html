
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Archiviazione Chat NexusCore</title>
  <script>
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name) || "";
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const fileName = getQueryParam("fileName");
      const nomeChat = getQueryParam("nomeChat");
      const modulo = getQueryParam("modulo");
      const note = getQueryParam("note");

      // Simulazione contenuto dinamico generato localmente
      const timestamp = new Date().toISOString();
      const fileContent = `# Archivio della chat: ${nomeChat}\n\nData: ${timestamp}\n\nContenuto rilevante estratto automaticamente dalla sessione.`;

      if (!fileName || !nomeChat) {
        console.error("❌ Parametri mancanti. Necessari fileName e nomeChat.");
        return;
      }

      const payload = {
        fileName,
        fileContent,
        nomeChat,
        modulo: modulo || nomeChat,
        note: note || "Archiviazione dinamica via auto.html POST"
      };

      try {
        const response = await fetch("/api/archivia", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const result = await response.text();
        console.log("✅ Risposta:", result);
      } catch (err) {
        console.error("❌ Errore nel POST:", err);
      }
    });
  </script>
</head>
<body style="display:none;">
</body>
</html>
